{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/luist/OneDrive/Documentos/Version2/Sistema2/lib/database.ts"],"sourcesContent":["// Neon database connection\r\nimport { neon } from '@neondatabase/serverless';\r\n\r\nif (!process.env.DATABASE_URL) {\r\n  throw new Error('DATABASE_URL environment variable is not set');\r\n}\r\n\r\nconst sql = neon(process.env.DATABASE_URL!);\r\n\r\nexport { sql };\r\n"],"names":[],"mappings":"AAAA,2BAA2B;;;;;AAC3B;;AAEA,IAAI,CAAC,QAAQ,GAAG,CAAC,YAAY,EAAE;IAC7B,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,MAAM,IAAA,gKAAI,EAAC,QAAQ,GAAG,CAAC,YAAY"}},
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/luist/OneDrive/Documentos/Version2/Sistema2/lib/security/rate-limit.ts"],"sourcesContent":["import NodeCache from 'node-cache';\r\n\r\ninterface RateLimitConfig {\r\n  windowMs: number; // Time window in milliseconds\r\n  maxRequests: number; // Max requests per window\r\n}\r\n\r\nconst DEFAULT_CONFIG: RateLimitConfig = {\r\n  windowMs: 60 * 1000, // 1 minute\r\n  maxRequests: 30,\r\n};\r\n\r\nclass RateLimiter {\r\n  private cache = new NodeCache({ stdTTL: 60, checkperiod: 30 });\r\n  private config: RateLimitConfig;\r\n\r\n  constructor(config: Partial<RateLimitConfig> = {}) {\r\n    this.config = { ...DEFAULT_CONFIG, ...config };\r\n  }\r\n\r\n  check(identifier: string): { allowed: boolean; remaining: number } {\r\n    const key = `ratelimit:${identifier}`;\r\n    let count = this.cache.get<number>(key) || 0;\r\n\r\n    if (count >= this.config.maxRequests) {\r\n      return {\r\n        allowed: false,\r\n        remaining: 0,\r\n      };\r\n    }\r\n\r\n    count += 1;\r\n    this.cache.set(key, count, Math.ceil(this.config.windowMs / 1000));\r\n\r\n    return {\r\n      allowed: true,\r\n      remaining: this.config.maxRequests - count,\r\n    };\r\n  }\r\n\r\n  reset(identifier: string): void {\r\n    this.cache.del(`ratelimit:${identifier}`);\r\n  }\r\n}\r\n\r\nexport const apiLimiter = new RateLimiter({\r\n  windowMs: 15 * 60 * 1000, // 15 minutes\r\n  maxRequests: 100,\r\n});\r\n\r\nexport const loginLimiter = new RateLimiter({\r\n  windowMs: 15 * 60 * 1000, // 15 minutes\r\n  maxRequests: 10,\r\n});\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAOA,MAAM,iBAAkC;IACtC,UAAU,KAAK;IACf,aAAa;AACf;AAEA,MAAM;IACI,QAAQ,IAAI,mJAAS,CAAC;QAAE,QAAQ;QAAI,aAAa;IAAG,GAAG;IACvD,OAAwB;IAEhC,YAAY,SAAmC,CAAC,CAAC,CAAE;QACjD,IAAI,CAAC,MAAM,GAAG;YAAE,GAAG,cAAc;YAAE,GAAG,MAAM;QAAC;IAC/C;IAEA,MAAM,UAAkB,EAA2C;QACjE,MAAM,MAAM,CAAC,UAAU,EAAE,YAAY;QACrC,IAAI,QAAQ,IAAI,CAAC,KAAK,CAAC,GAAG,CAAS,QAAQ;QAE3C,IAAI,SAAS,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE;YACpC,OAAO;gBACL,SAAS;gBACT,WAAW;YACb;QACF;QAEA,SAAS;QACT,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,KAAK,OAAO,KAAK,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,GAAG;QAE5D,OAAO;YACL,SAAS;YACT,WAAW,IAAI,CAAC,MAAM,CAAC,WAAW,GAAG;QACvC;IACF;IAEA,MAAM,UAAkB,EAAQ;QAC9B,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,UAAU,EAAE,YAAY;IAC1C;AACF;AAEO,MAAM,aAAa,IAAI,YAAY;IACxC,UAAU,KAAK,KAAK;IACpB,aAAa;AACf;AAEO,MAAM,eAAe,IAAI,YAAY;IAC1C,UAAU,KAAK,KAAK;IACpB,aAAa;AACf"}},
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/luist/OneDrive/Documentos/Version2/Sistema2/lib/notifications.ts"],"sourcesContent":["import { sql } from '@/lib/database';\r\n\r\nexport async function createNotification(type: string, message: string, meta: any = {}) {\r\n  try {\r\n    await sql`\r\n      INSERT INTO notifications (type, message, meta, read)\r\n      VALUES (${type}, ${message}, ${JSON.stringify(meta)}, false)\r\n    `;\r\n  } catch (err) {\r\n    console.error('[createNotification Error]', err);\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEO,eAAe,mBAAmB,IAAY,EAAE,OAAe,EAAE,OAAY,CAAC,CAAC;IACpF,IAAI;QACF,MAAM,wHAAG,CAAC;;cAEA,EAAE,KAAK,EAAE,EAAE,QAAQ,EAAE,EAAE,KAAK,SAAS,CAAC,MAAM;IACtD,CAAC;IACH,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,8BAA8B;IAC9C;AACF"}},
    {"offset": {"line": 144, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/luist/OneDrive/Documentos/Version2/Sistema2/app/api/customers/%5Bid%5D/route.ts"],"sourcesContent":["// app/api/customers/[id]/route.ts\r\nimport { sql } from '@/lib/database';\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { apiLimiter } from '@/lib/security/rate-limit';\r\nimport { createNotification } from '@/lib/notifications';\r\n\r\nexport async function PUT(\r\n  request: NextRequest, \r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    const ip = request.headers.get('x-forwarded-for') || 'unknown';\r\n    const allowed = apiLimiter.check(`customers:put:${ip}`);\r\n    if (!allowed.allowed) return NextResponse.json({ success: false, message: 'Rate limit exceeded' }, { status: 429 });\r\n\r\n    const { id: idParam } = await params; // Await params aquí\r\n    const id = Number(idParam);\r\n    const body = await request.json();\r\n    const { name, document, phone, email, userId } = body;\r\n\r\n    if (!id) return NextResponse.json({ success: false, message: 'Customer id required' }, { status: 400 });\r\n\r\n    // If document changed, ensure uniqueness\r\n    if (document) {\r\n      const dup = await sql`SELECT id FROM customers WHERE document = ${document} AND id <> ${id}`;\r\n      if (dup.length > 0) return NextResponse.json({ success: false, message: 'Document already used' }, { status: 409 });\r\n    }\r\n\r\n    await sql`\r\n      UPDATE customers SET name=${name}, document=${document}, phone=${phone}, email=${email}, updated_at=NOW()\r\n      WHERE id=${id}\r\n    `;\r\n\r\n    // Audit\r\n    await sql`\r\n      INSERT INTO audit_logs (entity_type, entity_id, action, user_id, details)\r\n      VALUES ('customer', ${id}, 'update', ${userId || null}, ${JSON.stringify({ name, document, phone, email })})\r\n    `;\r\n\r\n    // Notification\r\n    await createNotification('cliente', `Cliente actualizado: ${name}`, { customerId: id });\r\n\r\n    return NextResponse.json({ success: true, message: 'Customer updated' });\r\n  } catch (err) {\r\n    console.error('[CUSTOMERS PUT Error]', err);\r\n    return NextResponse.json({ success: false, message: 'Error updating customer' }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function DELETE(\r\n  request: NextRequest, \r\n  { params }: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    const ip = request.headers.get('x-forwarded-for') || 'unknown';\r\n    const allowed = apiLimiter.check(`customers:delete:${ip}`);\r\n    if (!allowed.allowed) return NextResponse.json({ success: false, message: 'Rate limit exceeded' }, { status: 429 });\r\n\r\n    const { id: idParam } = await params; // Await params aquí\r\n    const id = Number(idParam);\r\n    if (!id) return NextResponse.json({ success: false, message: 'Customer id required' }, { status: 400 });\r\n\r\n    await sql`UPDATE customers SET active = false, updated_at = NOW() WHERE id = ${id}`;\r\n\r\n    // Audit\r\n    await sql`INSERT INTO audit_logs (entity_type, entity_id, action) VALUES ('customer', ${id}, 'delete')`;\r\n\r\n    return NextResponse.json({ success: true, message: 'Customer deactivated' });\r\n  } catch (err) {\r\n    console.error('[CUSTOMERS DELETE Error]', err);\r\n    return NextResponse.json({ success: false, message: 'Error deleting customer' }, { status: 500 });\r\n  }\r\n}"],"names":[],"mappings":"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"}}]
}